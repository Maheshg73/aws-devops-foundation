#!/bin/bash
set -e

if [ "$EUID" -ne 0 ]; then
  echo "ERROR: Please run as root or with sudo"
  exit 1
fi

if ! command -v apt-get >/dev/null 2>&1; then
  echo "ERROR: This script supports Debian-based systems only"
  exit 1
fi


LOG_FILE="/var/log/provision.log"

log() {
  echo "$(date '+%Y-%m-%d %H:%M:%S') - $1" | tee -a $LOG_FILE
}

log "Starting EC2 provisioning"

log "Updating package index"
sudo apt-get update -y

if ! command -v nginx >/dev/null 2>&1; then
  log "Installing Nginx"
  sudo apt-get install -y nginx
else
  log "Nginx already installed"
fi

log "Enabling and starting Nginx"
sudo systemctl enable nginx
sudo systemctl restart nginx

log "Provisioning completed successfully"
